package uk.gov.moj.cpp.progression.service.disqualificationreferral;import static com.google.common.io.Resources.getResource;import static java.nio.charset.Charset.defaultCharset;import static java.time.ZoneOffset.UTC;import static java.util.Optional.of;import static java.util.UUID.randomUUID;import static org.junit.Assert.assertEquals;import static uk.gov.justice.core.courts.LjaDetails.ljaDetails;import uk.gov.justice.core.courts.Address;import uk.gov.justice.core.courts.CourtCentre;import uk.gov.justice.core.courts.LjaDetails;import uk.gov.justice.core.courts.ReferredDefendant;import uk.gov.justice.core.courts.ReferredPerson;import uk.gov.justice.core.courts.ReferredPersonDefendant;import uk.gov.justice.services.common.converter.ObjectToJsonObjectConverter;import uk.gov.justice.services.common.converter.StringToJsonObjectConverter;import uk.gov.justice.services.common.converter.jackson.ObjectMapperProducer;import uk.gov.justice.services.messaging.JsonEnvelope;import java.io.IOException;import java.time.Clock;import java.time.Instant;import java.time.LocalDate;import java.util.Optional;import java.util.UUID;import javax.inject.Inject;import javax.json.JsonObject;import com.fasterxml.jackson.databind.ObjectMapper;import com.google.common.io.Resources;import org.junit.Rule;import org.junit.jupiter.api.Test;import org.mockito.InjectMocks;import org.mockito.Spy;import org.mockito.junit.MockitoJUnit;import org.mockito.junit.MockitoRule;public class ReferralDisqualifyWarningDataAggregatorTest {    private final Clock clock = Clock.fixed(Instant.parse("2017-02-16T10:15:30.00Z"), UTC);    private final UUID prosecutionCaseId = randomUUID();    final private String ouCode = "B01FA00";    final private String ljaCode = "2578";    final private UUID courtCenterId = UUID.randomUUID();    @Rule    public MockitoRule rule = MockitoJUnit.rule();    private JsonEnvelope event;    @Spy    private final ObjectMapper objectMapper = new ObjectMapperProducer().objectMapper();    @Spy    @InjectMocks    private final ObjectToJsonObjectConverter objectToJsonObjectConverter = new ObjectToJsonObjectConverter(objectMapper);    @Inject    private StringToJsonObjectConverter stringToJsonObjectConverter = new StringToJsonObjectConverter();    @InjectMocks    private ReferralDisqualifyWarningEnglishDataAggregator referralDisqualifyWarningEnglishDataAggregator = new ReferralDisqualifyWarningEnglishDataAggregator();    @InjectMocks    private ReferralDisqualifyWarningWelshDataAggregator referralDisqualifyWarningWelshDataAggregator = new ReferralDisqualifyWarningWelshDataAggregator();    @Test    public void testAggregateReferralDisqualifyWarningData() throws IOException {       String expectedAggregationVal = Resources.toString(getResource("referral-disqualify-warning-english-parameters.json"), defaultCharset());        expectedAggregationVal = expectedAggregationVal.replaceAll("CASE_URN", "caseUrn")                .replace("LJA_NAME", "ljaName")                .replace("COURT_CENTER", "courtCentreName");        JsonObject expectedAggregationOutcome = stringToJsonObjectConverter.convert(expectedAggregationVal);        final CourtCentre courtCentre = getCourtCentre();        final Optional<LjaDetails> ljaDetails = getLjaDetails();        final ReferredDefendant referredDefendant = getDefendant();        final JsonObject actualAggregationOutcome = referralDisqualifyWarningEnglishDataAggregator.aggregateReferralDisqualifyWarningData("caseUrn", courtCentre, ljaDetails.get(), referredDefendant.getPersonDefendant().getPersonDetails());        assertEquals(expectedAggregationOutcome, actualAggregationOutcome);    }    private CourtCentre getCourtCentre() {        return CourtCentre.courtCentre().withId(courtCenterId).withCode(ouCode).withName("courtCentreName").build();    }    private Optional<LjaDetails> getLjaDetails() {        return of(ljaDetails().withLjaCode(ljaCode).withLjaName("ljaName").withWelshLjaName("welshLjaName").build());    }    private ReferredDefendant getDefendant() {        final Address address = Address.address().withAddress1("one")                .withAddress2("two")                .withAddress3("three")                .withAddress4("four")                .withAddress5("five")                .withPostcode("HP17 8SD").build();        final ReferredPerson person = ReferredPerson.referredPerson()                .withFirstName("firstname")                .withLastName("lastname")                .withMiddleName("middlename")                .withDateOfBirth(LocalDate.of(1998, 8, 10))                .withAddress(address).build();        final ReferredPersonDefendant personDefendant = ReferredPersonDefendant.referredPersonDefendant()                .withPersonDetails(person).build();        return ReferredDefendant.referredDefendant().withId(randomUUID())                .withMasterDefendantId(randomUUID())                .withProsecutionCaseId(prosecutionCaseId)                .withPersonDefendant(personDefendant).build();    }}